<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Gaufre Widget Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .demo-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .demo-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .demo-section h3 {
            margin-top: 0;
            color: #333;
        }
        button {
            background: #000091;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1212ff;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <a href="/">Back to index</a>
        <h1>La Gaufre Widget Demo</h1>
        <p>This demo shows how to use the La Gaufre widget to display a list of services with subscription status.</p>

        <div class="demo-section">
            <h2>Basic Usage</h2>
            <p>Open the widget with default settings:</p>
            <button type="button" onclick="openBasicWidget(this)">Open La Gaufre Widget</button>
            <div class="code-block"><pre>
_lasuite_widget.push(['lagaufre', 'init', {
    api: '/widgets/demo/lagaufre-data.json',
    open: true
}]);</pre></div>
        </div>

        <div class="demo-section">
            <h2>With ANCT Data</h2>
            <p>Open the widget with ANCT services data:</p>
            <button type="button" onclick="openBasicWidget(this)">Open with ANCT Data</button>
            <div class="code-block"><pre>
_lasuite_widget.push(['lagaufre', 'init', {
    api: 'https://operateurs.suite.anct.gouv.fr/api/v1.0/lagaufre/services/?operator=9f5624fc-ef99-4d10-ae3f-403a81eb16ef&siret=21870030000013',
    open: true
}]);</pre></div>
        </div>

        <div class="demo-section">
            <h2>With LaSuite data and style</h2>
            <p>Open the widget with gradient background:</p>
            <button type="button" onclick="openBasicWidget(this)">Open with LaSuite Data</button>
            <div class="code-block"><pre>
// With gradient background
_lasuite_widget.push(['lagaufre', 'init', {
    api: 'https://lasuite.numerique.gouv.fr/api/services',
    open: true,
    background: 'linear-gradient(180deg, #eceffd 0%, #FFFFFF 20%)',
    headerLogo: 'https://lasuite.numerique.gouv.fr/_next/static/media/suite-numerique.ebdb6ce9.svg',
    headerUrl: 'https://lasuite.numerique.gouv.fr',
    showFooter: true
}]);</pre></div>
        </div>

        <div class="demo-section">
            <h2>With Custom Font</h2>
            <p>Open the widget with custom font family:</p>
            <button type="button" onclick="openBasicWidget(this)">Open with Custom Font</button>
            <div class="code-block"><pre>
// With custom font
_lasuite_widget.push(['lagaufre', 'init', {
    api: '/widgets/demo/lagaufre-data.json',
    open: true,
    fontFamily: 'Georgia, serif'
}]);</pre></div>
        </div>

        <div class="demo-section">
            <h2>Positioning Options</h2>
            <p>Control widget position and behavior:</p>

            <button type="button" onclick="openBasicWidget(this)">Top Right</button>
            <div class="code-block"><pre>
// Top Right positioning
_lasuite_widget.push(['lagaufre', 'init', {
    api: '/widgets/demo/lagaufre-data.json',
    open: true,
    label: 'La Gaufre - Top Right',
    position: 'fixed',
    top: 20,
    right: 20
}]);</pre></div>
            
            <button type="button" onclick="openBasicWidget(this)">Bottom Left</button>
            <div class="code-block"><pre>
// Bottom Left positioning
_lasuite_widget.push(['lagaufre', 'init', {
    api: '/widgets/demo/lagaufre-data.json',
    open: true,
    label: 'La Gaufre - Bottom Left',
    position: 'fixed',
    bottom: 20,
    left: 20
}]);</pre></div>
            
            <button type="button" onclick="openBasicWidget(this)">Below button (absolute)</button>
            <div class="code-block"><pre>
// Absolute & dynamic positioning, tied to a button
(button) => {
    _lasuite_widget.push(['lagaufre', 'init', {
        api: '/widgets/demo/lagaufre-data.json',
        open: true,
        label: 'La Gaufre - Bottom Left',
        position: () => {
            return {
                position: 'absolute',
                top: button.offsetTop + button.offsetHeight + 10,
                right: window.innerWidth - button.offsetLeft - button.offsetWidth
            };
        },
        buttonElement: button
    }]);
}</pre></div>

        </div>

        <div class="demo-section">
            <h2>No dialog</h2>
            <p>You can insert the widget into an existing container:</p>
            <div id="custom-box" style="width: 100%; max-width: 500px; height: 300px; overflow: hidden; background-color: #f0f0f0; border: 1px solid blue; border-radius: 8px; padding: 10px;"></div>
            <button type="button" onclick="openBasicWidget(this)">Open inside box</button>
            
            <div class="code-block"><pre>
// No dialog
_lasuite_widget.push(['lagaufre', 'init', {
    api: '/widgets/demo/lagaufre-data.json',
    open: true,
    dialogElement: document.getElementById('custom-box')
}]);</pre></div>

            <button type="button" onclick="openBasicWidget(this)">Close widget</button>
            <div class="code-block"><pre>
_lasuite_widget.push(['lagaufre', 'close']);</pre></div>
        </div>

        <div class="demo-section">
            <h2>With hardcoded data</h2>
            <p>You can pass static data and avoid any API calls:</p>
            <button type="button" onclick="openBasicWidget(this)">Open La Gaufre Widget</button>
            <div class="code-block"><pre>
_lasuite_widget.push(['lagaufre', 'init', {
    open: true,
    data: {
        "services": [
            {
                "name": "Authentication Service",
                "url": "https://example.com/auth",
                "logo": "/widgets/demo/logos/auth.svg",
            },
            {
                "name": "Document Portal",
                "url": "https://example.com/docs",
                "logo": "/widgets/demo/logos/docs.svg",
            },
        ]
    }
}]);</pre></div>
        </div>

        <div class="demo-section">
            <h2>Open and close Widget Programmatically</h2>
            <p>Close the widget programmatically after 2 seconds:</p>
            <button type="button" onclick="openBasicWidget(this)">Open Widget</button>
            <div class="code-block"><pre>
_lasuite_widget.push(['lagaufre', 'init', {
    api: '/widgets/demo/lagaufre-data.json'
}]);
setTimeout(() => {
    _lasuite_widget.push(['lagaufre', 'open']);
}, 300);
setTimeout(() => {
    _lasuite_widget.push(['lagaufre', 'close']);
}, 2000);</pre></div>

            <button type="button" onclick="openBasicWidget(this)">Toggle Widget Programmatically</button>
            <div class="code-block"><pre>
_lasuite_widget.push(['lagaufre', 'toggle']);</pre></div>

        </div>

        <div class="demo-section">
            <h2>Full localization</h2>
            <p>You can fully localize the widget:</p>
            <button type="button" onclick="openBasicWidget(this)">Open Widget</button>
            <div class="code-block"><pre>
// Full localization
_lasuite_widget.push(['lagaufre', 'init', {
    api: '/widgets/demo/lagaufre-data.json',
    open: true,
    label: 'La Gaufre',
    headerLogo: 'https://lasuite.numerique.gouv.fr/_next/static/media/suite-numerique.ebdb6ce9.svg',
    headerUrl: 'https://lasuite.numerique.gouv.fr',
    headerLabel: 'A propos de LaSuite',
    closeLabel: 'Fermer la liste des services',
    loadingText: 'Chargement des services...',
    newWindowLabelSuffix: ' (nouvelle fenÃªtre)'
}]);</pre></div>
        </div>

        <div class="demo-section">
            <h2>API Response Format</h2>
            <p>The widget expects the following API response format:</p>
            <div class="code-block"><pre>
{
  "services": [
    {
      "name": "Service Name",
      "url": "https://service-url.com",
      "maturity": "stable",
      "logo": "/path/to.svg"
    }
  ]
}</pre></div>
        </div>
    </div>

    <!-- Load the La Gaufre widget -->
    <script type="module" src="/widgets/dist/lagaufre.js"></script>
    
    <script>
        // Initialize the widget system
        window._lasuite_widget = window._lasuite_widget || [];
        
        function openBasicWidget(button) {
            // Find the code block that immediately follows this button
            const codeBlock = button.nextElementSibling;
            
            if (codeBlock && codeBlock.classList.contains('code-block')) {
                // Extract the JavaScript code from the code block
                const codeText = codeBlock.textContent.trim();
                
                // Remove comments and clean up the code
                const cleanCode = codeText.replace(/^\/\/.*$/gm, '').trim();
                
                // Execute the code
                try {
                    var ret = eval(cleanCode);
                    if (typeof ret === 'function') {
                        return ret(button);;
                    }
                } catch (error) {
                    console.error('Error executing widget code:', error);
                    alert('Error executing widget code: ' + error.message);
                }
            } else {
                console.error('No code block found after button');
            }
        }
        
    </script>
</body>
</html>
